---
title: "Mysql Base"
date: 2022-02-10T20:47:45+08:00
draft: true
---

### Mysql 基础架构

Mysql 可以分为 Server 层和存储引擎层。

Server 层包括连接器、分析器、优化器、执行器等，包括 Mysql 大多数的核心功能

存储引擎复制数据的存储和提取，是插件式的，比较常用的存储引擎是 InnoDB.

#### 连接器

连接器主要负责与客户端建立连接、获取权限、维持和管理连接。连接命令如下

```ssh
mysql -h$ip -P$port -u$user -p
```
建立连接时，会校验用户名，密码。同时会读取权限信息，接下来这个连接里面的权限都会使用初始读取的权限信息。

所以更改权限不会影响已存在的连接。

#### 分析器

对 SQL 语句做词法和语法分析

#### 优化器

为 SQL 语句选取最优的查询方案

#### 执行器

执行 SQL 语句

### redo log 和 binlog

* redo log 是 InnoDB 引擎特有的；binlog 是 Server 层的
* redo log 是物理日志，记录的是“某个数据页的修改”；binlog 记录的原始语句，如“给ID=2这行的c字段加1”
* redolog 是循环写，binlog 是追加写。

更新数据时， InnoDB 更新数据到内存，写入 redo log，处于 prepare 状态。Server 层写入 binlog，然后提交事务，处于 commit 状态。通过两阶段提交来保证 redolog和binlog的一致性


#### 事务

隔离级别
* 读未提交：事务未提交时，它做的变更就可以被别的事务看到
* 读提交：事务提交后，它做的变更就可以被别的事务看到
* 可重复读：一个事务执行过程中看到的数据与事务启动时看到的数据一致。未提交的变更对其余事务也是不可见。
* 串行化：事务串行

在实现上，数据库会创建一个视图，访问的数据以视图的逻辑结果为准。
可重复读，视图在事务启动时创建，整改事务存在期间都使用这个视图
读提交，视图在 SQL 语句开始执行时创建

#### InnoDB 索引模型

在 InnoDB 中，表都是根据主键顺序以索引的形式存放的，这种存储方式的表称为索引组织表

* 主键索引：又称为聚簇索引，节点存的是整行数据
* 非主键索引：节点存的是主键的值

覆盖索引

索引对应的值满足查询条件，不需要回表

```
SELECT ID from T where k = 3
```